#!/bin/bash

set -ueo pipefail

echo "machine ${BUILDKITE_PLUGIN_GIT_PUSH_MACHINE}\n\tlogin ${BUILDKITE_PLUGIN_GIT_PUSH_LOGIN}\n\tpassword ${BUILDKITE_PLUGIN_GIT_PUSH_PASSWORD}" > ~/.netrc

git remote add underworld ${BUILDKITE_PLUGIN_GIT_PUSH_REMOTE:-origin}

git fetch origin && git push heroku ${BUILDKITE_BRANCH}:master --force

git remote rm underworld
